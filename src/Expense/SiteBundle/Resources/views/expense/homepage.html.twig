<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{{ asset('bootstrap/css/bootstrap.min.css') }}" />
    <link rel="stylesheet" href="{{ asset('bootstrap/font-awesome/css/social-buttons.css') }}" />
    <link rel="stylesheet" href="{{ asset('bootstrap/font-awesome/css/font-awesome.min.css') }}" />

    <script src="{{ asset('myjs/jquery.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bootstrap/js/bootstrap.js') }}" type="text/javascript"></script>
    <style type="text/css">
    </style>
    
    <script src="{{ asset('morris/raphael-min.js') }}"></script>
	<script src="{{ asset('morris/morris.js') }}"></script>
	<script src="{{ asset('morris/lib/prettify.js') }}"></script>
	<link rel="stylesheet" href="{{ asset('morris/lib/prettify.css') }}">
	<link rel="stylesheet" href="{{ asset('morris/morris.css') }}">
</head>
<body style="padding-top: 60px;">
<!-- top header needs in seperate file -->
<div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">Expense</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
            </ul>
            {% if app.user %}
            	<p class="navbar-text pull-right">Signed in as <a href="#" class="navbar-link"><i class="icon-user icon-white"></i>{{app.user.username }} </a> | <a href="{{ path('_my_logout') }}" class="navbar-link">Signout</a></p>
            {% else %}
	            <form class="navbar-form pull-right">
	              <input class="span2" type="text" placeholder="Username">
	              <input class="span2" type="password" placeholder="Password">
	              <button type="submit" class="btn">Sign in</button>
	            </form>
            {% endif %}
          </div>
        </div>
      </div>
</div>
<!-- end of top header -->

<div class="container">
	{{ include(
		'ExpenseSiteBundle:Expense:totalExpenseModule.html.twig'
	) }}

	<div class="btn-group" id="chartgrp" data-toggle="buttons-radio">
    	<button class="btn active">Monthly</button>
    	<button class="btn">Weekly</button>
	</div>
	
	<div id="graph"></div>
	<script type="text/javascript">
	/* data stolen from http://howmanyleft.co.uk/vehicle/jaguar_'e'_type */
	var day_data1 = [
	  {"period": "2012-10-01", "amount": "50", "type": "monthly"},
	  {"period": "2012-09-30", "amount": "100", "type": "monthly"}
	];

	var selected = "monthly";
	
	{% autoescape false %}
		var day_data = {{ graphData }};
	{% endautoescape %}
	var chart = Morris.Line({
	  element: 'graph',
	  data: day_data,
	  xkey: 'period',
	  ykeys: ['amount'],
	  labels: ['Amount'],
	  parseTime: false
	});

	$("#chartgrp .btn").click(function(){
		alert($(this).html());
		if ($(this).html() == 'Monthly'){
			selected = "monthly";
			$.ajax({
				url: "{{ url("graph_data") }}",
				dataType: "json",
				data: {'user': "1", 'type': selected },
				method: 'POST',
				error: function(data){
					alert("server error");
				},
				success: function(data){
					chart.setData(data);
				},
				
			});
		}
	});

	chart.on('click', function(i, row){
		$("#chartgrp .btn").button('toggle');
		if (selected != "weekly"){
			selected = "weekly";
			$.ajax({
				url: "{{ url("graph_data") }}",
				dataType: "json",
				data: {'user': "1", 'type': selected, 'month': row.period },
				method: 'POST',
				error: function(data){
					alert("server error");
				},
				success: function(data){
					chart.setData(data);
				},
				
			});
		}
	});
	</script>
	
	<fieldset>
	<!-- <form class="form-inline" method="POST"> -->
	{{ form_start(expense, {'method': 'post', 'attr' : { 'class': 'form-inline' }  }) }}
 		{{ form_errors(expense) }}
		<legend>Expense: </legend>
		<div class="input-prepend">
			<span class="add-on">{{ app.user.currencySymbol }}</span>
			{{ form_widget(expense.amount, 
				{ 'attr': {
								"placeholder" : "Amount",
						  }
				}
			) }}
		</div>
			{{ form_widget(expense.description,
				{ 'attr': {
								"placeholder" : "Description"
						  }
				}
			) }}
		<input type="submit" value=" Add " class="btn btn-primary"/>
	{{ form_end(expense) }}
	<!-- </form> -->
	</fieldset>
	
	{{ render(controller('ExpenseSiteBundle:Expense:expenseList', {
		'page': ePage
	})) }}

	 
	<div class="pagination">
		  <ul>
		    <li {% if ePage == 1 %} class="disabled" {%  endif %}><a href="{% if ePage == 1 %}#{% else %}{{ path("expense_homepage", {'ePage' : ePage-1 }) }}{%  endif %}">Prev</a></li>
			{% for i in 1..totalPagerCount %}
				 <li {% if ePage == i %} class="active" {%  endif %}><a href="{{ path("expense_homepage", {'ePage' : i }) }}">{{ i }}</a></li>
			{% endfor %}
		    <li {% if ePage == totalPagerCount %} class="disabled" {%  endif %}><a href="{% if ePage == totalPagerCount %}#{% else %}{{ path("expense_homepage", {'ePage' : ePage+1 }) }}{%  endif %}">Next</a></li>
		  </ul>
	</div>
	
	
</div>

</body>
</html>